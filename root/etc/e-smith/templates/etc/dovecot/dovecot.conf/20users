#
# 20users -- configure user authentication and storage
#
first_valid_uid = { 
    $gid = (getgrnam('vmail'))[2] or die('Missing vmail group');
    $uid = (getpwnam('vmail'))[2] or die('Missing vmail user'); 
}
last_valid_uid = { $uid; }

mail_uid = vmail
mail_gid = vmail

# See http://wiki2.dovecot.org/Authentication/MasterUsers
auth_master_user_separator = *
passdb \{
  driver = passwd-file
  args = /etc/dovecot/master-users
  master = yes
\}

{
    # Implementation of AdminIsMaster. See also /etc/pam.d/dovecot-master template

    if($dovecot{'AdminIsMaster'} ne 'enabled') {
        return '';
    }

    $OUT = "passdb {
  driver = pam
  master = yes
  args = dovecot-master
}";
}

# Database for system users
passdb \{
  driver = pam
  args = max_requests=100 failure_show_msg=yes blocking=yes 
\}

userdb \{
  driver = passwd
  override_fields = uid={$uid} gid={$gid} home=/var/lib/nethserver/vmail/%u
\}

# Location of mailboxes:
mail_location = maildir:~/Maildir

# Username formatting before it's looked up from databases
auth_username_format = %u

